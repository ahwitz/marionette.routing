{"version":3,"file":null,"sources":["../src/routecontext.js","../src/cherrytree-adapter.js","../src/route.js","../src/routerlink.js","../src/index.js"],"sourcesContent":["function RouteContext(routes, route) {\r\n  let routeIndex = routes.indexOf(route)\r\n  this.parentRoutes = routes.slice(0, routeIndex)\r\n}\r\n\r\nRouteContext.prototype.trigger = function() {\r\n  let parentRoutes = this.parentRoutes\r\n  for (let i = parentRoutes.length - 1; i >= 0; i--) {\r\n    let channel = parentRoutes[i]._contextChannel\r\n    if (channel) {\r\n      channel.trigger.apply(channel, arguments)\r\n    }\r\n  }\r\n}\r\n\r\nRouteContext.prototype.request = function(name) {\r\n  let parentRoutes = this.parentRoutes\r\n  for (let i = parentRoutes.length - 1; i >= 0; i--) {\r\n    let channel = parentRoutes[i]._contextChannel\r\n    if (channel && channel._requests[name]) {\r\n      return channel.request.apply(channel, arguments)\r\n    }\r\n  }\r\n}\r\n\r\nexport default RouteContext\r\n","/**\n * Marionette Routing\n *\n * Copyright © 2015-2016 Luiz Américo Pereira Câmara. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport _ from 'underscore'\nimport Radio from 'backbone.radio'\nimport cherrytree from 'cherrytree'\nimport Route from './route'\n\nlet mnRouteMap = Object.create(null)\nexport const routerChannel = Radio.channel('router')\nlet router\n\nexport function createRouter(options) {\n  if (router) {\n    throw new Error('Instance of router already created')\n  }\n  return router = Route.prototype.$router = cherrytree(options)\n}\n\nexport function destroyRouter(instance) {\n  router = null\n  Route.prototype.$router = null\n  mnRouteMap = Object.create(null)\n  instance.destroy()\n}\n\nexport function getMnRoutes(routes) {\n  return routes.map(function (route) {\n    return mnRouteMap[route.name]\n  })\n}\n\nrouterChannel.reply('transitionTo', function () {\n  return router.transitionTo.apply(router, arguments)\n})\n\nrouterChannel.reply('isActive', function () {\n  return router.isActive.apply(router, arguments)\n})\n\nrouterChannel.reply('generate', function () {\n  return router.generate.apply(router, arguments)\n})\n\nrouterChannel.reply('goBack', function () {\n  //in wait of a better implementation\n  history.back();\n})\n\nfunction getChangingIndex(prevRoutes, currentRoutes){\n  var index, prev, current;\n  const count = Math.max(prevRoutes.length, currentRoutes.length)\n  for (index = 0; index < count; index++) {\n    prev = prevRoutes[index]\n    current = currentRoutes[index]\n    if (!(prev && current) || (prev.name !== current.name) || !_.isEqual(prev.params, current.params)) {\n      break\n    }\n  }\n  return index\n}\n\nfunction findRouteConfig(routeName, index, routes) {\n  let parentRoutes = routes.slice(0, index).reverse().map(function (route) {\n    return mnRouteMap[route.name]\n  })\n  let config\n  parentRoutes.some(function (route) {\n    let childRoutes = _.result(route, 'childRoutes')\n    config = childRoutes && childRoutes[routeName]\n    if (_.isFunction(config) && !(config.prototype instanceof Route)) {\n      config = config.call(route)\n    }\n    return config\n  })\n  return config\n}\n\nfunction createRouteInstance(options, config) {\n  if (options.prototype instanceof Route) {\n    return new options(undefined, config)\n  }\n  let routeOptions = _.extend({}, options.routeOptions, _.pick(options, ['viewClass', 'viewOptions']))\n  if (options.routeClass) {\n    return new options.routeClass(routeOptions, config)\n  } else if (options.viewClass) {\n    return new Route(routeOptions, config)\n  }\n}\n\nfunction createMnRoute(route, index, routes) {\n  let instanceConfig = {\n    name: route.name,\n    path: route.path,\n    options: _.clone(route.options)\n  }\n  let instance = createRouteInstance(route.options, instanceConfig)\n  if (!instance) {\n    let routeConfig = findRouteConfig(route.name, index, routes)\n    return Promise.resolve(routeConfig).then(function (options) {\n      return options && createRouteInstance(options, instanceConfig)\n    })\n  }\n  return instance\n}\n\nfunction getParentRegion(routes, route) {\n  var region, parent\n  let routeIndex = routes.indexOf(route) - 1\n  while (routeIndex >= 0) {\n    parent = routes[routeIndex]\n    if (parent.view && parent.$config.options.outlet !== false) {\n      region = parent.getOutlet()\n      if (region) {\n        return region\n      } else {\n        throw new Error(`No outlet region defined in ${parent.$config.name} route`)\n      }\n    }\n    routeIndex--\n  }\n  return router.rootRegion\n}\n\nexport function middleware(transition) {\n\n  routerChannel.trigger('before:transition', transition)\n\n  if (transition.isCancelled) return ;\n\n  let prevRoutes = transition.prev.routes\n  let changingIndex = getChangingIndex(prevRoutes, transition.routes)\n  var routeIndex, routeInstance, deactivated = []\n\n  //deactivate previous routes\n  for (routeIndex = prevRoutes.length - 1; routeIndex >= changingIndex; routeIndex--) {\n    routeInstance = mnRouteMap[prevRoutes[routeIndex].name]\n    if (routeInstance) {\n      deactivated.push(routeInstance)\n    }\n  }\n\n  if (deactivated.some(function (route) {\n      routerChannel.trigger('before:deactivate', transition, route)\n      return transition.isCancelled\n    })) return\n\n  if (deactivated.some(function (route) {\n      route.deactivate(transition)\n      routerChannel.trigger('deactivate', transition, route)\n      return transition.isCancelled\n    })) return\n\n  //build route tree and creating instances if necessary\n  let mnRoutes = transition.mnRoutes = []\n\n  let promise = transition.routes.reduce(function (acc, route, i, routes) {\n    return acc.then(function (res) {\n      let instance = mnRouteMap[route.name]\n      if (instance) {\n        res.push(instance)\n        return res\n      } else {\n        instance = createMnRoute(route, i, routes)\n        return Promise.resolve(instance).then(function (mnRoute) {\n          if (!mnRoute) {\n            throw new Error(`Unable to create route ${route.name}: routeClass or viewClass must be defined`)\n          }\n          mnRouteMap[route.name] = mnRoute\n          res.push(mnRoute)\n          return res\n        })\n      }\n    });\n  }, Promise.resolve(mnRoutes));\n\n  //activate routes in order\n  let activated\n\n  promise = promise.then(function () {\n    activated = mnRoutes.slice(changingIndex)\n    return activated.reduce(function (prevPromise, mnRoute) {\n      routerChannel.trigger('before:activate', transition, mnRoute)\n      return prevPromise.then(function () {\n        if (!transition.isCancelled) {\n          return Promise.resolve(mnRoute.activate(transition)).then(function () {\n            if (!transition.isCancelled) {\n              routerChannel.trigger('activate', transition, mnRoute)\n            }\n          })\n        }\n        return Promise.resolve()\n      })\n    }, Promise.resolve())\n  })\n\n  transition.then(function () {\n    router.state.mnRoutes = mnRoutes\n    routerChannel.trigger('transition', transition)\n  }).catch(function (err) {\n    if (err.type !== 'TransitionCancelled' && err.type !== 'TransitionRedirected') {\n      routerChannel.trigger('transition:error', transition, err)\n    }\n  })\n\n  //render views\n  return promise.then(function () {\n    if (transition.isCancelled) return ;\n    //ensure at least the target (last) route is rendered\n    if (!activated.length && mnRoutes.length) {\n      activated.push(mnRoutes[mnRoutes.length - 1])\n    }\n\n    let renderQueue = activated.reduce(function (memo, mnRoute) {\n      if (mnRoute.viewClass) {\n        if (memo.length && memo[memo.length - 1].$config.options.outlet === false) {\n          memo.pop()\n        }\n        memo.push(mnRoute)\n      }\n      return memo\n    }, [])\n\n    renderQueue.forEach(function (mnRoute) {\n      let parentRegion = getParentRegion(mnRoutes, mnRoute)\n      mnRoute.renderView(parentRegion, transition)\n    })\n  })\n}","import _ from 'underscore'\nimport Radio from 'backbone.radio'\nimport Marionette from 'backbone.marionette'\nimport RouteContext from './routecontext'\nimport {getMnRoutes, routerChannel} from './cherrytree-adapter'\n\nexport default Marionette.Object.extend(\n  {\n    constructor (options, config) {\n      this.mergeOptions(options, ['viewClass', 'viewOptions'])\n      this.$config = config\n      Marionette.Object.call(this, options)\n      this._bindContext()\n    },\n\n    cidPrefix: 'rou',\n\n    activate() {\n\n    },\n\n    deactivate() {\n\n    },\n\n    renderView(region, transition) {\n      //todo: move renderView out of Route class??\n      if (!this.viewClass) {\n        throw new Error('render: viewClass not defined')\n      }\n      if (this.view && this.updateView(transition)) return ;\n      let view = new this.viewClass(_.result(this, 'viewOptions', {}))\n      this.listenToOnce(view, 'destroy', function () {\n        this.view = void 0\n      })\n      if (region) {\n        region.show(view)\n      } else {\n        // if region is undefined means no rootRegion is defined\n        // accept a pre-rendered view in those situations throwing otherwise\n        if (!view.isRendered()) throw new Error('No root outlet region defined')\n      }\n      this.view = view\n      routerChannel.trigger('route:render', this)\n      if (this.viewEvents) {\n        Marionette.bindEvents(this, view, this.viewEvents)\n      }\n    },\n\n    updateView() {\n\n    },\n\n    getContext() {\n      //todo: cache context??\n      let state = this.$router.state\n      let mnRoutes = (state.activeTransition || state).mnRoutes\n      if (!mnRoutes) {\n        mnRoutes = getMnRoutes(state.routes)\n      }\n      return new RouteContext(mnRoutes, this)\n    },\n\n    getOutlet() {\n      return this.view.getRegion('outlet')\n    },\n\n    _bindContext() {\n      let channel, requests = _.result(this, 'contextRequests'),\n        events = _.result(this, 'contextEvents')\n      if (!requests && !events) {\n        return\n      }\n\n      this._contextChannel = channel = new Radio.Channel('__routeContext_' + this.cid)\n\n      this.bindRequests(channel, requests)\n      this.bindEvents(channel, events)\n    },\n\n    $router: null\n  }\n)\n","import _ from 'underscore'\nimport Marionette from 'backbone.marionette'\nimport {routerChannel} from './cherrytree-adapter'\n\nfunction getRouteParams(el) {\n  let result = {}\n  let attributes = el.attributes\n\n  for (let i = 0; i < attributes.length; i++) {\n    let attr = attributes[i]\n    if (attr.name.indexOf('param-') === 0) {\n      let paramName = attr.name.slice('param-'.length)\n      result[paramName] = attr.value\n    }\n  }\n  return result\n}\n\nfunction createLinks(view) {\n  let $routes = view.$('[route]');\n\n  $routes.each(function () {\n    let routeName = this.getAttribute('route')\n    if (!routeName) return;\n    let params = getRouteParams(this)\n    let href = routerChannel.request('generate', routeName, params)\n    if (this.tagName === 'A') {\n      this.setAttribute('href', href)\n    } else {\n      view.$(this).find('a').eq(0).attr({href: href})\n    }\n  })\n}\n\nexport default Marionette.Behavior.extend({\n  initialize() {\n    let view = this.view\n    this.listenTo(routerChannel, 'transition', this.onTransition)\n    if (view.el) {\n      view.initialize = _.wrap(view.initialize, function (fn) {\n        let args = _.rest(arguments, 1)\n        fn.apply(view, args)\n        if (view.isRendered()) createLinks(view)\n      })\n    }\n  },\n\n  events: {\n    'click [route]:not(a)': 'onLinkClick'\n  },\n\n  onTransition() {\n    let view = this.view\n    this.$('[route]').each(function () {\n      let $el = view.$(this)\n      let routeName = $el.attr('route')\n      if (!routeName) return;\n      let isActive = routerChannel.request('isActive', routeName, getRouteParams(this))\n      $el.toggleClass('active', isActive)\n    })\n  },\n\n  onLinkClick(e) {\n    let el = e.currentTarget\n    if (this.$(el).find('a').length) return ;\n    let routeName = el.getAttribute('route')\n    if (!routeName) return;\n    let params = getRouteParams(el)\n    routerChannel.request('transitionTo', routeName, params)\n  },\n\n  onRender() {\n    createLinks(this.view)\n  },\n\n  onDestroy() {\n    this.stopListening(routerChannel)\n  }\n})","/**\n * Marionette Routing\n *\n * Copyright © 2015-2016 Luiz Américo Pereira Câmara. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nexport {default as Route} from './route'\n\nexport {default as RouterLink} from './routerlink'\n\nexport {middleware, createRouter, destroyRouter} from './cherrytree-adapter'\n\n"],"names":["RouteContext","routes","route","routeIndex","indexOf","parentRoutes","slice","prototype","trigger","i","length","channel","_contextChannel","apply","arguments","request","name","_requests","mnRouteMap","Object","create","routerChannel","Radio","router","createRouter","options","Error","Route","$router","cherrytree","destroyRouter","instance","destroy","getMnRoutes","map","reply","transitionTo","isActive","generate","back","getChangingIndex","prevRoutes","currentRoutes","index","prev","current","count","Math","max","_","isEqual","params","findRouteConfig","routeName","reverse","config","some","childRoutes","result","isFunction","call","createRouteInstance","undefined","routeOptions","extend","pick","routeClass","viewClass","createMnRoute","instanceConfig","path","clone","routeConfig","Promise","resolve","then","getParentRegion","region","parent","view","$config","outlet","getOutlet","rootRegion","middleware","transition","isCancelled","changingIndex","routeInstance","deactivated","push","deactivate","mnRoutes","promise","reduce","acc","res","mnRoute","activated","prevPromise","activate","state","catch","err","type","renderQueue","memo","pop","forEach","parentRegion","renderView","Marionette","mergeOptions","_bindContext","updateView","listenToOnce","show","isRendered","viewEvents","bindEvents","activeTransition","getRegion","requests","events","Channel","cid","bindRequests","getRouteParams","el","attributes","attr","paramName","value","createLinks","$routes","$","each","getAttribute","href","tagName","setAttribute","find","eq","Behavior","listenTo","onTransition","initialize","wrap","fn","args","rest","$el","toggleClass","e","currentTarget","stopListening"],"mappings":"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"}