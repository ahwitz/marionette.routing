{"version":3,"file":null,"sources":["../src/routecontext.js","../src/cherrytree-adapter.js","../src/route.js","../src/routerlink.js","../src/index.js"],"sourcesContent":["function RouteContext(routes, route) {\r\n  let routeIndex = routes.indexOf(route)\r\n  this.parentRoutes = routes.slice(0, routeIndex)\r\n}\r\n\r\nRouteContext.prototype.trigger = function() {\r\n  let parentRoutes = this.parentRoutes\r\n  for (let i = parentRoutes.length - 1; i >= 0; i--) {\r\n    let channel = parentRoutes[i]._contextChannel\r\n    if (channel) {\r\n      channel.trigger.apply(channel, arguments)\r\n    }\r\n  }\r\n}\r\n\r\nRouteContext.prototype.request = function(name) {\r\n  let parentRoutes = this.parentRoutes\r\n  for (let i = parentRoutes.length - 1; i >= 0; i--) {\r\n    let channel = parentRoutes[i]._contextChannel\r\n    if (channel && channel._requests[name]) {\r\n      return channel.request.apply(channel, arguments)\r\n    }\r\n  }\r\n}\r\n\r\nexport default RouteContext\r\n","/**\n * Marionette Routing\n *\n * Copyright © 2015-2016 Luiz Américo Pereira Câmara. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport _ from 'underscore'\nimport Radio from 'backbone.radio'\nimport cherrytree from 'cherrytree'\nimport Route from './route'\n\nlet mnRouteMap = Object.create(null)\nexport const routerChannel = Radio.channel('router')\nlet router\n\nexport function createRouter(options) {\n  if (router) {\n    throw new Error('Instance of router already created')\n  }\n  return router = Route.prototype.$router = cherrytree(options)\n}\n\nexport function destroyRouter(instance) {\n  router = null\n  Route.prototype.$router = null\n  mnRouteMap = Object.create(null)\n  instance.destroy()\n}\n\nexport function getMnRoutes(routes) {\n  return routes.map(function (route) {\n    return mnRouteMap[route.name]\n  })\n}\n\nrouterChannel.reply('transitionTo', function () {\n  return router.transitionTo.apply(router, arguments)\n})\n\nrouterChannel.reply('isActive', function () {\n  return router.isActive.apply(router, arguments)\n})\n\nrouterChannel.reply('generate', function () {\n  return router.generate.apply(router, arguments)\n})\n\nrouterChannel.reply('goBack', function () {\n  //in wait of a better implementation\n  history.back();\n})\n\nfunction getChangingIndex(prevRoutes, currentRoutes){\n  var index, prev, current;\n  const count = Math.max(prevRoutes.length, currentRoutes.length)\n  for (index = 0; index < count; index++) {\n    prev = prevRoutes[index]\n    current = currentRoutes[index]\n    if (!(prev && current) || (prev.name !== current.name) || !_.isEqual(prev.params, current.params)) {\n      break\n    }\n  }\n  return index\n}\n\nfunction findRouteConfig(routeName, index, routes) {\n  let parentRoutes = routes.slice(0, index).reverse().map(function (route) {\n    return mnRouteMap[route.name]\n  })\n  let config\n  parentRoutes.some(function (route) {\n    let childRoutes = _.result(route, 'childRoutes')\n    config = childRoutes && childRoutes[routeName]\n    if (_.isFunction(config) && !(config.prototype instanceof Route)) {\n      config = config.call(route)\n    }\n    return config\n  })\n  return config\n}\n\nfunction createRouteInstance(options, config) {\n  if (options.prototype instanceof Route) {\n    return new options(undefined, config)\n  }\n  let routeOptions = _.extend({}, options.routeOptions, _.pick(options, ['viewClass', 'viewOptions']))\n  if (options.routeClass) {\n    return new options.routeClass(routeOptions, config)\n  } else if (options.viewClass) {\n    return new Route(routeOptions, config)\n  }\n}\n\nfunction createMnRoute(route, index, routes) {\n  let instanceConfig = {\n    name: route.name,\n    path: route.path,\n    options: _.clone(route.options)\n  }\n  let instance = createRouteInstance(route.options, instanceConfig)\n  if (!instance) {\n    let routeConfig = findRouteConfig(route.name, index, routes)\n    return Promise.resolve(routeConfig).then(function (options) {\n      return options && createRouteInstance(options, instanceConfig)\n    })\n  }\n  return instance\n}\n\nfunction getParentRegion(routes, route) {\n  var region, parent\n  let routeIndex = routes.indexOf(route) - 1\n  while (routeIndex >= 0) {\n    parent = routes[routeIndex]\n    if (parent.view && parent.$config.options.outlet !== false) {\n      region = parent.getOutlet()\n      if (region) {\n        return region\n      } else {\n        throw new Error(`No outlet region defined in ${parent.$config.name} route`)\n      }\n    }\n    routeIndex--\n  }\n  return router.rootRegion\n}\n\nfunction renderViews (mnRoutes, activated, transition) {\n  //ensure at least the target (last) route is rendered\n  let renderCandidates = activated.length ? activated : mnRoutes.slice(-1)\n\n  let renderQueue = renderCandidates.reduce(function (memo, mnRoute) {\n    if (mnRoute.viewClass) {\n      if (memo.length && memo[memo.length - 1].$config.options.outlet === false) {\n        memo.pop()\n      }\n      memo.push(mnRoute)\n    }\n    return memo\n  }, [])\n\n  renderQueue.forEach(function (mnRoute) {\n    let parentRegion = getParentRegion(mnRoutes, mnRoute)\n    mnRoute.renderView(parentRegion, transition)\n  })\n}\n\nfunction isActivatingRoute (route) {\n  return this.activating && this.activating.indexOf(route) !== -1\n}\n\nfunction isTargetRoute (route) {\n  return this.mnRoutes && this.mnRoutes.indexOf(route) === this.mnRoutes.length - 1\n}\n\nexport function middleware(transition) {\n\n  transition.isActivating = isActivatingRoute\n  transition.isTarget = isTargetRoute\n\n  routerChannel.trigger('before:transition', transition)\n\n  if (transition.isCancelled) return ;\n\n  let prevRoutes = transition.prev.routes\n  let changingIndex = getChangingIndex(prevRoutes, transition.routes)\n  var routeIndex, routeInstance, deactivated = []\n\n  //deactivate previous routes\n  for (routeIndex = prevRoutes.length - 1; routeIndex >= changingIndex; routeIndex--) {\n    routeInstance = mnRouteMap[prevRoutes[routeIndex].name]\n    if (routeInstance) {\n      deactivated.push(routeInstance)\n    }\n  }\n\n  if (deactivated.some(function (route) {\n      routerChannel.trigger('before:deactivate', transition, route)\n      return transition.isCancelled\n    })) return\n\n  if (deactivated.some(function (route) {\n      route.deactivate(transition)\n      routerChannel.trigger('deactivate', transition, route)\n      return transition.isCancelled\n    })) return\n\n  //build route tree and creating instances if necessary\n  let mnRoutes = transition.mnRoutes = []\n\n  let promise = transition.routes.reduce(function (acc, route, i, routes) {\n    return acc.then(function (res) {\n      let instance = mnRouteMap[route.name]\n      if (instance) {\n        res.push(instance)\n        return res\n      } else {\n        instance = createMnRoute(route, i, routes)\n        return Promise.resolve(instance).then(function (mnRoute) {\n          if (!mnRoute) {\n            throw new Error(`Unable to create route ${route.name}: routeClass or viewClass must be defined`)\n          }\n          mnRouteMap[route.name] = mnRoute\n          res.push(mnRoute)\n          return res\n        })\n      }\n    });\n  }, Promise.resolve(mnRoutes));\n\n  //activate routes in order\n  let activated\n\n  promise = promise.then(function () {\n    activated = transition.activating = mnRoutes.slice(changingIndex)\n    return activated.reduce(function (prevPromise, mnRoute) {\n      routerChannel.trigger('before:activate', transition, mnRoute)\n      return prevPromise.then(function () {\n        if (!transition.isCancelled) {\n          return Promise.resolve(mnRoute.activate(transition)).then(function () {\n            if (!transition.isCancelled) {\n              routerChannel.trigger('activate', transition, mnRoute)\n            }\n          })\n        }\n        return Promise.resolve()\n      })\n    }, Promise.resolve())\n  })\n\n  transition.then(function () {\n    router.state.mnRoutes = mnRoutes\n    routerChannel.trigger('transition', transition)\n    transition.activating = []\n  }).catch(function (err) {\n    if (err.type !== 'TransitionCancelled' && err.type !== 'TransitionRedirected') {\n      routerChannel.trigger('transition:error', transition, err)\n    }\n  })\n\n  //render views\n  return promise.then(function () {\n    if (transition.isCancelled) return ;\n\n    let loadPromise = mnRoutes.reduce(function (prevPromise, mnRoute) {\n      let nextPromise = prevPromise\n      if (_.isFunction(mnRoute.load)) {\n        if (prevPromise) {\n          return prevPromise.then(function () {\n            return Promise.resolve(mnRoute.load(transition))\n          }).catch(function () {\n            return Promise.resolve(mnRoute.load(transition))\n          })\n        } else {\n          return Promise.resolve(mnRoute.load(transition))\n        }\n      }\n      return nextPromise\n    }, undefined)\n\n    if (loadPromise) {\n      return new Promise(function (resolve) {\n        loadPromise.then(function () {\n          renderViews(mnRoutes, activated, transition)\n          resolve()\n        }).catch(function () {\n          renderViews(mnRoutes, activated, transition)\n          resolve()\n        })\n      })\n    } else {\n      renderViews(mnRoutes, activated, transition)\n    }\n  })\n}","import _ from 'underscore'\nimport Radio from 'backbone.radio'\nimport Marionette from 'backbone.marionette'\nimport RouteContext from './routecontext'\nimport {getMnRoutes, routerChannel} from './cherrytree-adapter'\n\nexport default Marionette.Object.extend(\n  {\n    constructor (options, config) {\n      this.mergeOptions(options, ['viewClass', 'viewOptions'])\n      this.$config = config\n      Marionette.Object.call(this, options)\n      this._bindContext()\n    },\n\n    cidPrefix: 'rou',\n\n    activate() {\n\n    },\n\n    deactivate() {\n\n    },\n\n    renderView(region, transition) {\n      //todo: move renderView out of Route class??\n      if (!this.viewClass) {\n        throw new Error('render: viewClass not defined')\n      }\n      if (this.view && this.updateView(transition)) return ;\n      let view = new this.viewClass(_.result(this, 'viewOptions', {}))\n      this.listenToOnce(view, 'destroy', function () {\n        this.view = void 0\n      })\n      if (region) {\n        region.show(view)\n      } else {\n        // if region is undefined means no rootRegion is defined\n        // accept a pre-rendered view in those situations throwing otherwise\n        if (!view.isRendered()) throw new Error('No root outlet region defined')\n      }\n      this.view = view\n      routerChannel.trigger('route:render', this)\n      if (this.viewEvents) {\n        Marionette.bindEvents(this, view, this.viewEvents)\n      }\n    },\n\n    updateView() {\n\n    },\n\n    getContext() {\n      //todo: cache context??\n      let state = this.$router.state\n      let mnRoutes = (state.activeTransition || state).mnRoutes\n      if (!mnRoutes) {\n        mnRoutes = getMnRoutes(state.routes)\n      }\n      return new RouteContext(mnRoutes, this)\n    },\n\n    getOutlet() {\n      return this.view.getRegion('outlet')\n    },\n\n    _bindContext() {\n      let channel, requests = _.result(this, 'contextRequests'),\n        events = _.result(this, 'contextEvents')\n      if (!requests && !events) {\n        return\n      }\n\n      this._contextChannel = channel = new Radio.Channel('__routeContext_' + this.cid)\n\n      this.bindRequests(channel, requests)\n      this.bindEvents(channel, events)\n    },\n\n    $router: null\n  }\n)\n","import _ from 'underscore'\nimport Marionette from 'backbone.marionette'\nimport {routerChannel} from './cherrytree-adapter'\nimport {$} from 'backbone'\n\nfunction attrChanged(mutations, observer) {\n  mutations.forEach(function (mutation) {\n    let attr = mutation.attributeName\n    if (attr.indexOf('param-') === 0 || attr.indexOf('query-') === 0) {\n      updateHref(mutation.target, observer.link)\n    }\n  })\n}\n\nconst attrObserverConfig = {attributes: true}\n\nfunction getAttributeValues(el, prefix, result) {\n  let attributes = el.attributes\n\n  for (let i = 0; i < attributes.length; i++) {\n    let attr = attributes[i]\n    if (attr.name.indexOf(prefix) === 0) {\n      let paramName = attr.name.slice(prefix.length)\n      result[paramName] = attr.value\n    }\n  }\n  return result\n}\n\nfunction updateHref(el, link) {\n  let routeName = el.getAttribute('route')\n  if (!routeName) return;\n  let params = getAttributeValues(el, 'param-', link.getDefaults(routeName, 'params', el))\n  let query = getAttributeValues(el, 'query-', link.getDefaults(routeName, 'query', el))\n  let href = routerChannel.request('generate', routeName, params, query)\n  let anchorEl\n  if (el.tagName === 'A') {\n    anchorEl = el\n  } else {\n    anchorEl = $(el).find('a').eq(0)[0]\n  }\n  if (anchorEl) anchorEl.setAttribute('href', href)\n  return anchorEl\n}\n\nfunction createLinks(routerLink) {\n  let rootEl = routerLink.options.rootEl\n  let selector = rootEl ? rootEl + ' [route]' : '[route]'\n  let $routes = routerLink.view.$(selector)\n\n  $routes.each(function () {\n    if (updateHref(this, routerLink)) {\n      if (routerLink.attrObserver) routerLink.attrObserver.observe(this, attrObserverConfig)\n    }\n  })\n}\n\nexport default Marionette.Behavior.extend({\n  initialize() {\n    let view = this.view\n    let self = this\n    this.listenTo(routerChannel, 'transition', this.onTransition)\n    if (view.el) {\n      view.initialize = _.wrap(view.initialize, function (fn) {\n        let args = _.rest(arguments, 1)\n        fn.apply(view, args)\n        if (view.isRendered()) createLinks(self)\n      })\n    }\n    if (window.MutationObserver) {\n      this.attrObserver = new window.MutationObserver(attrChanged)\n      this.attrObserver.link = this\n    }\n  },\n\n  events: {\n    'click [route]:not(a)': 'onLinkClick'\n  },\n\n  onTransition() {\n    let self = this\n    let rootEl = self.options.rootEl\n    let selector = rootEl ? rootEl + ' [route]' : '[route]'\n    self.$(selector).each(function () {\n      let $el = $(this)\n      let routeName = $el.attr('route')\n      if (!routeName) return;\n      let params = getAttributeValues(this, 'param-', self.getDefaults(routeName, 'params', this))\n      let query = getAttributeValues(this, 'query-', self.getDefaults(routeName, 'query', this))\n      let activeClass = this.hasAttribute('active-class') ? $el.attr('active-class') : 'active'\n      if (activeClass) {\n        let isActive = routerChannel.request('isActive', routeName, params, query)\n        $el.toggleClass(activeClass, isActive)\n      }\n    })\n  },\n\n  onLinkClick(e) {\n    let el = e.currentTarget\n    if (this.$(el).find('a').length) return ;\n    let routeName = el.getAttribute('route')\n    if (!routeName) return;\n    let params = getAttributeValues(el, 'param-', this.getDefaults(routeName, 'params', el))\n    let query = getAttributeValues(el, 'query-', this.getDefaults(routeName, 'query', el))\n    routerChannel.request('transitionTo', routeName, params, query)\n  },\n\n  onRender() {\n    createLinks(this)\n  },\n\n  onDestroy() {\n    this.stopListening(routerChannel)\n  },\n  \n  getDefaults(routeName, prop, el) {\n    let defaults = this.options.defaults\n    if (_.isFunction(defaults)) defaults = defaults.call(this.view)\n    let routeDefaults = defaults && defaults[routeName]\n    let result = (routeDefaults && routeDefaults[prop])\n    if (_.isFunction(result)) result = result.call(this.view, el)\n    return _.clone(result) || {}\n  },\n\n  attrObserver: undefined\n})","/**\n * Marionette Routing\n *\n * Copyright © 2015-2016 Luiz Américo Pereira Câmara. All rights reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nexport {default as Route} from './route'\n\nexport {default as RouterLink} from './routerlink'\n\nexport {middleware, createRouter, destroyRouter} from './cherrytree-adapter'\n\n"],"names":["RouteContext","routes","route","routeIndex","indexOf","parentRoutes","slice","prototype","trigger","i","length","channel","_contextChannel","apply","arguments","request","name","_requests","mnRouteMap","Object","create","routerChannel","Radio","router","createRouter","options","Error","Route","$router","cherrytree","destroyRouter","instance","destroy","getMnRoutes","map","reply","transitionTo","isActive","generate","back","getChangingIndex","prevRoutes","currentRoutes","index","prev","current","count","Math","max","_","isEqual","params","findRouteConfig","routeName","reverse","config","some","childRoutes","result","isFunction","call","createRouteInstance","undefined","routeOptions","extend","pick","routeClass","viewClass","createMnRoute","instanceConfig","path","clone","routeConfig","Promise","resolve","then","getParentRegion","region","parent","view","$config","outlet","getOutlet","rootRegion","renderViews","mnRoutes","activated","transition","renderCandidates","renderQueue","reduce","memo","mnRoute","pop","push","forEach","parentRegion","renderView","isActivatingRoute","activating","isTargetRoute","middleware","isActivating","isTarget","isCancelled","changingIndex","routeInstance","deactivated","deactivate","promise","acc","res","prevPromise","activate","state","catch","err","type","loadPromise","nextPromise","load","Marionette","mergeOptions","_bindContext","updateView","listenToOnce","show","isRendered","viewEvents","bindEvents","activeTransition","getRegion","requests","events","Channel","cid","bindRequests","attrChanged","mutations","observer","mutation","attr","attributeName","target","link","attrObserverConfig","attributes","getAttributeValues","el","prefix","paramName","value","updateHref","getAttribute","getDefaults","query","href","anchorEl","tagName","$","find","eq","setAttribute","createLinks","routerLink","rootEl","selector","$routes","each","attrObserver","observe","Behavior","self","listenTo","onTransition","initialize","wrap","fn","args","rest","window","MutationObserver","$el","activeClass","hasAttribute","toggleClass","e","currentTarget","stopListening","prop","defaults","routeDefaults"],"mappings":"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"}